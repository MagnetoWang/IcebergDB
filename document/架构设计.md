# 架构设计

## 数据模块

### 处理的数据

- 神经网络参数
- 传统mysql数据

### 数据模型

- kv
- row
- Block
- index

### 数据检验

- 大数据，大对象检验辅助信息合法性
- 每一条的数据检查数据本身内容

## 模块

- 思想：要有组件的思维，就和storm的bolt一样
- log 
- replica
- base
- storage

## 功能要求

- 高性能
- 高可用
- 分布式
- 内存+磁盘！！！
- 内存负责计算模块内容
- 磁盘负责保存数据
- schema可以动态扩展

## 性能要求

- 写一条记录
- 读一条记录
- 改一条记录
- 删一条记录
- 写大量记录
- 读大量记录
- 改大量记录
- 删大量记录
- 备份
- 恢复
- 压缩
- 垃圾回收

## 内存设计

- 

## 磁盘设计

- 列式存储

## 日志设计

- 数据流scribe系统：https://github.com/facebookarchive/scribe

## 技术优化点

- 内存映射：https://blog.csdn.net/mg0832058/article/details/5890688

- bloom：https://blog.csdn.net/mg0832058/article/details/5890688

- key前缀共享：https://blog.csdn.net/sparkliang/article/details/8635821

- 粗糙集索引Rough Set Index：

- 零拷贝ZeroCopy：https://developer.ibm.com/articles/j-zerocopy/

- 计算异或值：巧用异或值的唯一性质，提高通信效率，参考Storm Acker的机制

- LMAX Disruptor Queue：https://lmax-exchange.github.io/disruptor/files/Disruptor-1.0.pdf

- write-ahead-log与append-only-file：https://my.oschina.net/blacklands/blog/875179

- lock-free skip list：https://stackoverflow.com/questions/3479043/how-to-implement-lock-free-skip-list



# 代码实现

## 数据结构

### 基本类型

- map 和 skiplist
- 底层用skiplist，外部在用map构成索引

### 调研结果

- map结构简单，容易操作
- hashmap
  - https://en.wikipedia.org/wiki/Hash_table
- sortmap vs unsortedmap
  - http://supercomputingblog.com/windows/ordered-map-vs-unordered-map-a-performance-study/
- 查找O(1)
- 跳表
  - https://en.wikipedia.org/wiki/Skip_list
- 树
- TreeMap、HashMap、ConcurrentSkipListMap比较
  - https://blog.csdn.net/bigtree_3721/article/details/51290960

## 数据压缩

### snappy

- https://github.com/google/snappy

## 代码设计

### base

- compression.h
- compression.cc
  - 所有的压缩算法实现
- string_ice.h
- string_ice.cc
  - 针对ice数据库的所有字符串操作
- skiplist.h
- skiplist.cc
- map.h
- map.cc
- hashmap.h
- hashmap.cc
  - 底部线程安全核心结构
- index.h
- index.cc
- coding.h
- coding.cc
  - 加密解码schema，操作

### storage

- table.h
- table.cc

### logger

- log_reader.h
- log_reader.cc
- log_writer.h
- log_writer.cc

### rpc

- ice_receive.h
- ice_receive.cc
- ice_send.h
- ice_send.cc

### proto

- table.proto
- tablet.proto

### io